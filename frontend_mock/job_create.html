<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8" />
    <title>求人投稿 | Aurelia</title>
</head>

<body>
    <h1>求人投稿フォーム</h1>

    <!-- ここでは action, method は使わず、JS側でfetch POSTする例にする -->
    <form id="job-form">
        <div>
            <label for="company_id">会社ID:</label>
            <input type="number" id="company_id" name="company_id" required />
        </div>

        <div>
            <label for="hiring_type">雇用形態:</label>
            <select id="hiring_type" name="hiring_type" required>
                <option value="intern">インターン</option>
                <option value="fulltime">フルタイム</option>
                <option value="parttime">パートタイム</option>
                <option value="contract">契約</option>
            </select>
        </div>

        <div>
            <label for="technology_type">技術スタック:</label>
            <input type="text" id="technology_type" name="technology_type" placeholder="例: Golang, Python..." />
        </div>

        <div>
            <label for="income_range">想定報酬:</label>
            <input type="number" id="income_range" name="income_range" required />
        </div>

        <div>
            <label for="job_tag">ジョブタグ:</label>
            <input type="text" id="job_tag" name="job_tag" placeholder="例: backend, data science..." />
        </div>

        <div>
            <label for="requirements">要件:</label>
            <textarea id="requirements" name="requirements" rows="3" placeholder="応募者に求めるスキル・経験など"></textarea>
        </div>

        <div>
            <label for="used_technology">利用技術:</label>
            <textarea id="used_technology" name="used_technology" rows="3"
                placeholder="Go, Docker, Kubernetesなど"></textarea>
        </div>

        <div>
            <button type="submit">投稿</button>
        </div>
    </form>

    <!-- JavaScript: フォームsubmitイベントをフックし、fetchでPOSTする例 -->
    <script>
        document.getElementById('job-form').addEventListener('submit', async (event) => {
            event.preventDefault(); // 画面遷移防止

            // フォームの値を取得
            const company_id = document.getElementById('company_id').value;
            const hiring_type = document.getElementById('hiring_type').value;
            const technology_type = document.getElementById('technology_type').value;
            const income_range = document.getElementById('income_range').value;
            const job_tag = document.getElementById('job_tag').value;
            const requirements = document.getElementById('requirements').value;
            const used_technology = document.getElementById('used_technology').value;

            // JSONデータとして組み立て
            const requestBody = {
                company_id: parseInt(company_id),
                hiring_type,
                technology_type,
                income_range: parseInt(income_range),
                job_tag,
                requirements,
                used_technology
            };

            try {
                const response = await fetch('/api/jobs', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });

                if (response.ok) {
                    alert('求人投稿が完了しました！');
                    // 必要に応じて画面をリロード or 別ページへ遷移など
                } else {
                    const data = await response.json();
                    alert(`エラーが発生しました: ${data.error || 'unknown error'}`);
                }
            } catch (error) {
                console.error(error);
                alert('通信エラーが発生しました');
            }
        });
    </script>
</body>

</html>
